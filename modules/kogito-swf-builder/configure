#!/bin/sh
set -e

cd "${KOGITO_HOME}"

"${MAVEN_HOME}"/bin/mvn -Dmaven.repo.local="${KOGITO_HOME}"/.m2/repository -U -B -s "${KOGITO_HOME}"/.m2/settings.xml \
io.quarkus.platform:quarkus-maven-plugin:"${QUARKUS_VERSION}":create \
-DprojectGroupId="${GROUP_ID:-org.acme}" \
-DprojectArtifactId="${ARTIFACT_ID:-kogito-base}" \
-DprojectVersionId="${VERSION_ID:-1.0.0-snapshot}" \
-DplatformVersion="${QUARKUS_VERSION}" \
-Dextensions="${QUARKUS_EXTENSIONS:-kogito-quarkus-serverless-workflow,kogito-addons-quarkus-knative-eventing,quarkus-kubernetes}"

cd "${KOGITO_HOME}"/"${ARTIFACT_ID:-kogito-base}"

"${MAVEN_HOME}"/bin/mvn -U -B clean install -DskipTests -Dmaven.repo.local="${KOGITO_HOME}"/.m2/repository -s "${KOGITO_HOME}"/.m2/settings.xml -Dquarkus.container-image.build=false

chown -R 1001:0 "${KOGITO_HOME}"
chmod -R ug+rwX "${KOGITO_HOME}"
